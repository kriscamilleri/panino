# /docker-compose.yml
version: '3.8'

services:
  api-service:
    build: ./backend/api-service
    restart: always
    environment:
      JWT_SECRET: ${JWT_SECRET}
      PORT: 8000
      NODE_ENV: production
      TURNSTILE_SECRET_KEY: ${TURNSTILE_SECRET_KEY}
      # Internal URL for PDF image resolution (Puppeteer runs in same container)
      INTERNAL_API_URL: http://localhost:8000
      # SMTP Production Settings
      SMTP_HOST: ${SMTP_HOST}
      SMTP_PORT: ${SMTP_PORT}
      SMTP_USER: ${SMTP_USER}
      SMTP_PASS: ${SMTP_PASS}
      SMTP_FROM: ${SMTP_FROM}
      FRONTEND_URL: ${FRONTEND_URL}
    volumes:
      - api-data:/app/data # Persist SQLite DBs
      - uploads-data:/app/uploads # Persist uploaded files
    ports:
      - "127.0.0.1:8000:8000"


volumes:
  api-data:
  uploads-data: